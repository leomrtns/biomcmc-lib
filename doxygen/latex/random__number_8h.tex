\hypertarget{random__number_8h}{}\subsection{random\+\_\+number.\+h File Reference}
\label{random__number_8h}\index{random\+\_\+number.\+h@{random\+\_\+number.\+h}}


Random number generation, with algorithms from the Gnu Scientific Library (G\+SL) and motivation from the Scalable Parallel Pseudo Random Number Generators Library (S\+P\+R\+NG).  


{\ttfamily \#include \char`\"{}random\+\_\+number\+\_\+gen.\+h\char`\"{}}\newline
Include dependency graph for random\+\_\+number.\+h\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{random__number_8h__incl}
\end{center}
\end{figure}
This graph shows which files directly or indirectly include this file\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{random__number_8h__dep__incl}
\end{center}
\end{figure}
\subsubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structbiomcmc__rng__struct}{biomcmc\+\_\+rng\+\_\+struct}
\begin{DoxyCompactList}\small\item\em Random number structure (combined Tausworthe algorithm) \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{random__number_8h_a7ab6b2fbca811d4db16dafffc88bd902}\label{random__number_8h_a7ab6b2fbca811d4db16dafffc88bd902}} 
typedef struct \hyperlink{structbiomcmc__rng__struct}{biomcmc\+\_\+rng\+\_\+struct} $\ast$ {\bfseries biomcmc\+\_\+rng}
\end{DoxyCompactItemize}
\subsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{random__number_8h_a9d5045f3aa04de0b94b321aea043dada}{biomcmc\+\_\+random\+\_\+number\+\_\+init} (unsigned long long int seed)
\begin{DoxyCompactList}\small\item\em High-\/level setup of a simple random number generator and initialization with a seed (not to be mixed with other low-\/level functions that update the seed or allocate memory). \end{DoxyCompactList}\item 
\mbox{\Hypertarget{random__number_8h_ace9dead018c13a4d682a3b1cc5defc76}\label{random__number_8h_ace9dead018c13a4d682a3b1cc5defc76}} 
void \hyperlink{random__number_8h_ace9dead018c13a4d682a3b1cc5defc76}{biomcmc\+\_\+random\+\_\+number\+\_\+finalize} (void)
\begin{DoxyCompactList}\small\item\em High-\/level finalization (memory release etc.) of the random number environment. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{random__number_8h_adeea4bf21dbe5cbfc7d545e8435b6855}\label{random__number_8h_adeea4bf21dbe5cbfc7d545e8435b6855}} 
\hyperlink{structbiomcmc__rng__struct}{biomcmc\+\_\+rng} \hyperlink{random__number_8h_adeea4bf21dbe5cbfc7d545e8435b6855}{new\+\_\+biomcmc\+\_\+rng} (unsigned long long int seed, int stream\+\_\+number)
\begin{DoxyCompactList}\small\item\em Allocate memory for new (Tausworthe + M\+T19937) generator from a pool of streams. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{random__number_8h_a7556fab9f7482092b8106b1ab54a5b1c}\label{random__number_8h_a7556fab9f7482092b8106b1ab54a5b1c}} 
void \hyperlink{random__number_8h_a7556fab9f7482092b8106b1ab54a5b1c}{del\+\_\+biomcmc\+\_\+rng} (\hyperlink{structbiomcmc__rng__struct}{biomcmc\+\_\+rng} r)
\begin{DoxyCompactList}\small\item\em Release memory occupied by biomcmc\+\_\+rng\+:\+: \end{DoxyCompactList}\item 
\mbox{\Hypertarget{random__number_8h_aac2831fa8bcae85637cce1f0c4c5d562}\label{random__number_8h_aac2831fa8bcae85637cce1f0c4c5d562}} 
unsigned long long int \hyperlink{random__number_8h_aac2831fa8bcae85637cce1f0c4c5d562}{biomcmc\+\_\+rng\+\_\+get\+\_\+initial\+\_\+seed} (void)
\begin{DoxyCompactList}\small\item\em Create initial seed based on time, combining time in microseconds and seconds (user-\/controled seed is not uint64\+\_\+t) \end{DoxyCompactList}\item 
\mbox{\Hypertarget{random__number_8h_a8f7d8f4c1e5de930c88330b52d17538e}\label{random__number_8h_a8f7d8f4c1e5de930c88330b52d17538e}} 
\hyperlink{structbiomcmc__rng__struct}{biomcmc\+\_\+rng} \hyperlink{random__number_8h_a8f7d8f4c1e5de930c88330b52d17538e}{new\+\_\+biomcmc\+\_\+rng\+\_\+from\+\_\+seed} (unsigned long long int seed, int stream\+\_\+number)
\begin{DoxyCompactList}\small\item\em Generate a vector of seeds (based on initial one), create and initialize stream with an element of this vector. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{random__number_8h_a6b5a367c8a609ab0292430306ae7d93a}\label{random__number_8h_a6b5a367c8a609ab0292430306ae7d93a}} 
double \hyperlink{random__number_8h_a6b5a367c8a609ab0292430306ae7d93a}{biomcmc\+\_\+rng\+\_\+snorm32} (void)
\begin{DoxyCompactList}\small\item\em Returns a random number from a Standard Normal distribution N(0,1) -\/ \hyperlink{prob__distribution_8h}{prob\+\_\+distribution.\+h} has general case. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{random__number_8h_ad33735d55fad58caeb2bf7b5b56cdc44}\label{random__number_8h_ad33735d55fad58caeb2bf7b5b56cdc44}} 
double \hyperlink{random__number_8h_ad33735d55fad58caeb2bf7b5b56cdc44}{biomcmc\+\_\+rng\+\_\+snorm} (void)
\begin{DoxyCompactList}\small\item\em Returns a random number from a Standard Normal distribution with maximum (52 bits) integer precision. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{random__number_8h_aa0dfcb9f5e5f636d9ee87756c3e04cf2}\label{random__number_8h_aa0dfcb9f5e5f636d9ee87756c3e04cf2}} 
double \hyperlink{random__number_8h_aa0dfcb9f5e5f636d9ee87756c3e04cf2}{biomcmc\+\_\+rng\+\_\+unif} (void)
\begin{DoxyCompactList}\small\item\em Returns a random number between 0 and 1 (including 1) with precision $\approx 10^{-15}$ (52 bits). \end{DoxyCompactList}\item 
\mbox{\Hypertarget{random__number_8h_a1c1442aeea748b656e9efb98e5d725ab}\label{random__number_8h_a1c1442aeea748b656e9efb98e5d725ab}} 
double \hyperlink{random__number_8h_a1c1442aeea748b656e9efb98e5d725ab}{biomcmc\+\_\+rng\+\_\+unif\+\_\+pos} (void)
\begin{DoxyCompactList}\small\item\em Returns a positive random number between 0 and 1 (excluding 0 and including 1) (52 bits). \end{DoxyCompactList}\item 
\mbox{\Hypertarget{random__number_8h_a26cc568dce9194edff7278e9721251ef}\label{random__number_8h_a26cc568dce9194edff7278e9721251ef}} 
uint64\+\_\+t \hyperlink{random__number_8h_a26cc568dce9194edff7278e9721251ef}{biomcmc\+\_\+rng\+\_\+unif\+\_\+int64} (uint64\+\_\+t n)
\begin{DoxyCompactList}\small\item\em Returns a long integer (64 bits) random number between 0 and n (excluding n), with $n < 10^{15}$. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{random__number_8h_a46f7b9363d5cb324e8cc18d5d2b6016d}\label{random__number_8h_a46f7b9363d5cb324e8cc18d5d2b6016d}} 
double \hyperlink{random__number_8h_a46f7b9363d5cb324e8cc18d5d2b6016d}{biomcmc\+\_\+rng\+\_\+unif32} (void)
\begin{DoxyCompactList}\small\item\em Returns a random number between 0 and 1 (including 1) with precision $\approx 10^{-9}$ (32 int bits). \end{DoxyCompactList}\item 
\mbox{\Hypertarget{random__number_8h_aa2307df858407307b7f3a0970dbbef84}\label{random__number_8h_aa2307df858407307b7f3a0970dbbef84}} 
double \hyperlink{random__number_8h_aa2307df858407307b7f3a0970dbbef84}{biomcmc\+\_\+rng\+\_\+unif\+\_\+pos32} (void)
\begin{DoxyCompactList}\small\item\em Returns a positive random number between 0 and 1 (including 1) (32 int bits). \end{DoxyCompactList}\item 
\mbox{\Hypertarget{random__number_8h_a366c181844faba3c00096cc755f3d762}\label{random__number_8h_a366c181844faba3c00096cc755f3d762}} 
uint32\+\_\+t \hyperlink{random__number_8h_a366c181844faba3c00096cc755f3d762}{biomcmc\+\_\+rng\+\_\+unif\+\_\+int} (uint32\+\_\+t n)
\begin{DoxyCompactList}\small\item\em Returns an integer (32 bits) random number between 0 and n (excluding n), provided $n < 4 10^9$ approx. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{random__number_8h_a2f093666e5bc35f2639c5a6d7951a96b}\label{random__number_8h_a2f093666e5bc35f2639c5a6d7951a96b}} 
uint64\+\_\+t \hyperlink{random__number_8h_a2f093666e5bc35f2639c5a6d7951a96b}{biomcmc\+\_\+rng\+\_\+get} (void)
\begin{DoxyCompactList}\small\item\em new value with 64 random bits \end{DoxyCompactList}\item 
\mbox{\Hypertarget{random__number_8h_af97680c1cf83fb81cfe52dc56ab37275}\label{random__number_8h_af97680c1cf83fb81cfe52dc56ab37275}} 
double \hyperlink{random__number_8h_af97680c1cf83fb81cfe52dc56ab37275}{biomcmc\+\_\+rng\+\_\+get\+\_\+52} (void)
\begin{DoxyCompactList}\small\item\em new value with 52 random bits as a double precision float \end{DoxyCompactList}\item 
\mbox{\Hypertarget{random__number_8h_a83059b4f006f03468c36a15acb55d773}\label{random__number_8h_a83059b4f006f03468c36a15acb55d773}} 
uint32\+\_\+t \hyperlink{random__number_8h_a83059b4f006f03468c36a15acb55d773}{biomcmc\+\_\+rng\+\_\+get\+\_\+32} (void)
\begin{DoxyCompactList}\small\item\em new value with 32 random bits \end{DoxyCompactList}\item 
\mbox{\Hypertarget{random__number_8h_a62a8cc19475bef4fe1477ba42e14a821}\label{random__number_8h_a62a8cc19475bef4fe1477ba42e14a821}} 
void \hyperlink{random__number_8h_a62a8cc19475bef4fe1477ba42e14a821}{biomcmc\+\_\+get\+\_\+time} (int $\ast$time)
\begin{DoxyCompactList}\small\item\em get current time with maximum precision and soter in vector time\mbox{[}2\mbox{]} \end{DoxyCompactList}\item 
\mbox{\Hypertarget{random__number_8h_a3444330ddcef251cc035a2d5d28cfb46}\label{random__number_8h_a3444330ddcef251cc035a2d5d28cfb46}} 
double \hyperlink{random__number_8h_a3444330ddcef251cc035a2d5d28cfb46}{biomcmc\+\_\+elapsed\+\_\+time} (int $\ast$now, int $\ast$past)
\begin{DoxyCompactList}\small\item\em returns the floating-\/point time in seconds elapsed between past\mbox{[}2\mbox{]} and now\mbox{[}2\mbox{]} \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{random__number_8h_aa6d5847992f74a215315ce3bb63dfd5f}\label{random__number_8h_aa6d5847992f74a215315ce3bb63dfd5f}} 
\hyperlink{structbiomcmc__rng__struct}{biomcmc\+\_\+rng} \hyperlink{random__number_8h_aa6d5847992f74a215315ce3bb63dfd5f}{biomcmc\+\_\+random\+\_\+number}
\begin{DoxyCompactList}\small\item\em pointer to pseudo-\/random number generator (should point to real stream, even when there are several) \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsubsection{Detailed Description}
Random number generation, with algorithms from the Gnu Scientific Library (G\+SL) and motivation from the Scalable Parallel Pseudo Random Number Generators Library (S\+P\+R\+NG). 

There are two ways of setting up the pseudo-\/random number generation\+: a high-\/level approach where we simply call one function before start using the generator and another after we finished using it, and a lower-\/level approach where we must allocate, seed and free the streams by hand. Both approaches are completely incompatible, and there is no check to avoid this mistake so the programmer should use the first, high-\/level approach unless he understand well the algorithms. The high-\/level approach is useful when one stream is enough (for instance, a serial program). In this case we use a (modified) maximally-\/equidistributed combined Linear Feedback Shift Register (L\+F\+SR, or Tausworthe) pseudo-\/random number generator (P\+R\+NG) whose seed is based on time of day.

The low level approach is useful if one needs several uncorrelated streams -\/ for example a parallel program where each node must have its own stream of pseudo-\/random numbers and a common stream shared by all nodes. For this we implemented a modified \href{http://www.mcs.anl.gov/~itf/dbpp/text/node119.html}{\tt random tree method} where a lagged-\/\+Fibonacci generator (two-\/tap Generalised Feedback Shift Register -\/ G\+F\+S\+R4) P\+R\+NG is used to generate the seeds for the (modified) Tausworthe streams. The seed for this G\+F\+S\+R4 generator is given by the time of day and should be set only once by the program, given its low randomness. The G\+F\+S\+R4 uses a vector of size $2^14$ which is initialized by an (quick-\/and-\/dirty) xorshift randomization of the seed, which makes it sensitive to the choice of this seed. I included a \href{http://ianbullard.squarespace.com/journal/2009/4/28/why-you-should-never-use-rand.html}{\tt gamerand fast randomization} over each element of the vector, modified for 64 bits (the algorithm is too simple to require a license and I\textquotesingle{}ve seen public domain versions of it; the original disclaimer is G\+P\+L-\/like). A more robust alternative {\bfseries not implemented here} would be to use a better P\+R\+NG to feed the initial vector of the G\+F\+S\+R4 generator. As noticed by \href{http://www.springerlink.com/content/ek34q1jwla5b6438/}{\tt C\+JK Tan and J\+AR Blais (H\+P\+CN 2000, L\+N\+CS 1823, 127-\/135)} another random tree method could be constructed with parallel G\+F\+S\+R4 streams where the initial states are created by an P\+R\+NG -\/ equivalent to our seed generator, but providing not only the seed but all $2^{14}$ elements to each stream. To ensure independence of streams -\/ since different seeds are just different points of the same stream -\/ we implemented all 150 parameter sets provided by \href{http://www.iro.umontreal.ca/~lecuyer/myftp/papers/tausme2.ps}{\tt L\textquotesingle{}ecuyer (Maths Comput 1999, pp.\+261)}for the Tausworthe generators. So we have at least 150 independent streams, with periods between $10^{14}$ and $10^{35}$ -\/ if I understood correctly the interpretation of the number of non-\/zero solutions of the polynomials $N_1$.

Our modification to the original Tausworthe (L\+F\+SR) algorithms is to combine it with the \href{http://wwwmaths.anu.edu.au/~brent/random.html}{\tt generalized Marsaglias\textquotesingle{}s xorshift P\+R\+NG called xorgens}, developed by Richard Brent and available under a G\+PL license. So the L\+F\+SR has one extra component from this independent xorshift (combined through a X\+OR). The seed for the xorshift is the same as for the Tausworthe.

All streams are of 64 bits (dependent on a \char`\"{}long long int\char`\"{} having 64 bits) but 32 bits or even 16 bits are available through wrapper functions. If your system does not provide 64 bit integers use the unwrapped versions instead. When working with more than one stream at the same time -\/ by the same node, using the example of a parallel program -\/ we must update by hand the variable pointed to by the global variable \+::random\+\_\+number to indicate which stream should be used.

Some original comments from the G\+SL can be found on \char`\"{}doc/random\+\_\+number\+\_\+generation.\+txt\char`\"{} 

\subsubsection{Function Documentation}
\mbox{\Hypertarget{random__number_8h_a9d5045f3aa04de0b94b321aea043dada}\label{random__number_8h_a9d5045f3aa04de0b94b321aea043dada}} 
\index{random\+\_\+number.\+h@{random\+\_\+number.\+h}!biomcmc\+\_\+random\+\_\+number\+\_\+init@{biomcmc\+\_\+random\+\_\+number\+\_\+init}}
\index{biomcmc\+\_\+random\+\_\+number\+\_\+init@{biomcmc\+\_\+random\+\_\+number\+\_\+init}!random\+\_\+number.\+h@{random\+\_\+number.\+h}}
\paragraph{\texorpdfstring{biomcmc\+\_\+random\+\_\+number\+\_\+init()}{biomcmc\_random\_number\_init()}}
{\footnotesize\ttfamily void biomcmc\+\_\+random\+\_\+number\+\_\+init (\begin{DoxyParamCaption}\item[{unsigned long long int}]{seed }\end{DoxyParamCaption})}



High-\/level setup of a simple random number generator and initialization with a seed (not to be mixed with other low-\/level functions that update the seed or allocate memory). 

The seed may be provided by calling function (mostly for debug) if not zero otherwise it is based on present time of day, and uses the Tausworthe pseudo-\/random number generator. The Tausworthe generator we use has a period of (at least?) $10^{35}$. This function allocates memory to global variable \+::random\+\_\+number directly 